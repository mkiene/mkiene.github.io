---
layout: compress
---

<!doctype html>

<!-- _includes/metadata-hook.html -->
<script src="https://www.desmos.com/api/v1.11/calculator.js?apiKey=672067a5e642448d8d5ca6cfb39c5737" defer></script>
<script src="{{ '/assets/js/desmos-import.js' | relative_url }}" defer></script>

{% include origin-type.html %}

{% include lang.html %}

{% if site.theme_mode %}
  {% capture prefer_mode %}data-mode="{{ site.theme_mode }}"{% endcapture %}
{% endif %}

<!-- `site.alt_lang` can specify a language different from the UI -->
<html lang="{{ page.lang | default: site.alt_lang | default: site.lang }}" {{ prefer_mode }}>
  {% include head.html %}

  <body>
    {% include sidebar.html lang=lang %}

    <div id="main-wrapper" class="d-flex justify-content-center">
      <div class="container d-flex flex-column px-xxl-5">
        {% include topbar.html lang=lang %}

        <div class="row flex-grow-1">
          <main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4">
            {% if layout.refactor or layout.layout == 'default' %}
              {% include refactor-content.html content=content lang=lang %}
            {% else %}
              {{ content }}
            {% endif %}
          </main>

          <!-- panel -->
          <aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted">
            <div class="access">
              {% include_cached update-list.html lang=lang %}
              {% include_cached trending-tags.html lang=lang %}
            </div>

            {% for _include in layout.panel_includes %}
              {% assign _include_path = _include | append: '.html' %}
              {% include {{ _include_path }} lang=lang %}
            {% endfor %}
          </aside>
        </div>

        <div class="row">
          <!-- tail -->
          <div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4">
            {% for _include in layout.tail_includes %}
              {% assign _include_path = _include | append: '.html' %}
              {% include {{ _include_path }} lang=lang %}
            {% endfor %}

            {% include_cached footer.html lang=lang %}
          </div>
        </div>

        {% include_cached search-results.html lang=lang %}
      </div>

      <aside aria-label="Scroll to Top">
        <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow">
          <i class="fas fa-angle-up"></i>
        </button>
      </aside>
    </div>

    <div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div>

    {% if site.pwa.enabled %}
      {% include_cached notification.html lang=lang %}
    {% endif %}

    <!-- Embedded scripts -->

    {% for _include in layout.script_includes %}
      {% assign _include_path = _include | append: '.html' %}
      {% include {{ _include_path }} %}
    {% endfor %}

    {% include_cached search-loader.html lang=lang %}



	<div id="vimcmd" hidden aria-live="polite">
		<span class="prompt">:</span>
		<input id="vimcmd-input" type="text" spellcheck="false" autocomplete="off" />
		<div id="vimcmd-help" hidden></div>
	</div>

	<style>
	#vimcmd {
		position: fixed; left: 50%; transform: translateX(-50%);
		bottom: 2rem; width: min(800px, 92vw);
		background: rgba(20,20,20,.9); color: #f0f0f0;
		border: 1px solid rgba(255,255,255,.2);
		border-radius: 6px; padding: .6rem .8rem; z-index: 9999;
		display: flex; align-items: center; gap: .5rem;
		box-shadow: 0 8px 30px rgba(0,0,0,.4);
		font: 16px/1.3 ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
	}
	#vimcmd .prompt { opacity: .8 }
	#vimcmd-input {
		flex: 1; border: none; outline: none; background: transparent; color: inherit;
	}
	#vimcmd-help {
		position: absolute; left: 0; right: 0; bottom: calc(100% + .5rem);
		background: rgba(20,20,20,.95); padding: .6rem .8rem; border-radius: 8px;
		border: 1px solid rgba(255,255,255,.15); font-size: 14px; white-space: pre-wrap;
	}
	</style>

	<script>
	(() => {
		const overlay = document.getElementById('vimcmd');
		const input = document.getElementById('vimcmd-input');
		const help = document.getElementById('vimcmd-help');
		let searchIndex = null;
		let openSince = 0;

		const HELP_TEXT = [
			'Commands:',
			':open /path | :o /path      – navigate to a path/URL',
			':search query | :s query     – site search (customize handler)',
			':grep text                   – search site content (search.json)',
			':dark | :light | :toggle     – theme controls',
			':top | :bottom               – scroll to top/bottom',
			':scroll 50% | :scroll 400px  – scroll by percent or px',
			':next | :prev                – follow <link rel="next|prev">',
			':help                        – show this help'
		].join('\n');

		// Open on ":" unless focused in an input/textarea/contenteditable
		window.addEventListener('keydown', (e) => {
			if (overlay.hidden && e.key === ':' && !isTypingTarget(e.target)) {
				e.preventDefault();
				openCmd();
			} else if (!overlay.hidden) {
				if (e.key === 'Escape') closeCmd();
			}
		});

		function isTypingTarget(el) {
			return el && (
				el.tagName === 'INPUT' ||
				el.tagName === 'TEXTAREA' ||
				el.isContentEditable
			);
		}

		function openCmd() {
			overlay.hidden = false;
			input.value = '';
			help.hidden = true;
			openSince = Date.now();
			input.focus();
		}

		function closeCmd() {
			overlay.hidden = true;
			help.hidden = true;
			input.blur();
		}

		// Execute on Enter
		input.addEventListener('keydown', async (e) => {
			if (e.key !== 'Enter') return;
			const raw = input.value.trim();
			if (!raw) { closeCmd(); return; }
			const {cmd, arg} = parseCommand(raw);
			try {
				await run(cmd, arg);
			} catch (err) {
				showHelp('Error: ' + (err?.message || err));
			}
		});

		function parseCommand(line) {
			const l = line.startsWith(':') ? line.slice(1) : line;
			const [head, ...rest] = l.split(/\s+/);
			return { cmd: (head || '').toLowerCase(), arg: rest.join(' ') };
		}

		function showHelp(text = HELP_TEXT) {
			help.textContent = text;
			help.hidden = false;
		}

		async function run(cmd, arg) {
			switch (cmd) {
				case 'help': showHelp(); break;

				case 'open':
				case 'o':
					if (!arg) return showHelp('Usage: :open /path-or-url');
					window.location.href = arg;
					break;

				case 'search':
				case 's':
					// Customize to your site’s search page if you have one
					if (!arg) return showHelp('Usage: :search query');
					window.location.href = '/search/?q=' + encodeURIComponent(arg);
					break;

				case 'grep':
					if (!arg) return showHelp('Usage: :grep text');
					await ensureIndex();
					const results = grep(searchIndex, arg);
					showHelp(formatResults(results));
					break;

				case 'dark':
					setTheme('dark'); break;
				case 'light':
					setTheme('light'); break;
				case 'toggle':
					setTheme(getTheme() === 'dark' ? 'light' : 'dark'); break;

				case 'top':
					window.scrollTo({ top: 0, behavior: 'smooth' }); break;
				case 'bottom':
					window.scrollTo({ top: document.documentElement.scrollHeight, behavior: 'smooth' }); break;
				case 'scroll':
					doScroll(arg); break;

				case 'next':
					followRel('next'); break;
				case 'prev':
					followRel('prev'); break;

				default:
					showHelp(`Unknown command: ${cmd}\n\n${HELP_TEXT}`);
			}
		}

		async function ensureIndex() {
			if (searchIndex) return;
			const res = await fetch('/search.json', { credentials: 'same-origin' });
			if (!res.ok) throw new Error('Failed to fetch /search.json');
			searchIndex = await res.json();
		}

		function grep(index, term) {
			const q = term.toLowerCase();
			const matches = [];
			for (const doc of index) {
				if (!doc.content) continue;
				const pos = doc.content.toLowerCase().indexOf(q);
				if (pos !== -1) {
					const start = Math.max(0, pos - 40);
					const end = Math.min(doc.content.length, pos + q.length + 40);
					const snippet = doc.content.slice(start, end).replace(/\s+/g, ' ').trim();
					matches.push({ title: doc.title, url: doc.url, snippet });
					if (matches.length >= 8) break;
				}
			}
			return matches;
		}

		function formatResults(results) {
			if (!results.length) return 'No matches.\n';
			return results.map(r => `• ${r.title}\n  ${r.url}\n  “…${r.snippet}…”`).join('\n\n');
		}

		function setTheme(mode) {
			const root = document.documentElement;
			root.dataset.mode = mode;        // use [data-theme="dark"] in CSS
			try { localStorage.setItem('theme', mode); } catch {}
			showHelp(`Theme: ${mode}`);
		}

		function getTheme() {
			return document.documentElement.dataset.theme || 'light';
		}

		function doScroll(arg) {
			if (!arg) return showHelp('Usage: :scroll 50% | :scroll 400px');
			const m = arg.match(/^(\d+)(%|px)$/);
			if (!m) return showHelp('Use % or px, e.g. :scroll 50%');
			const val = parseInt(m[1], 10); const unit = m[2];
			if (unit === '%') {
				const by = Math.round(window.innerHeight * (val/100));
				window.scrollBy({ top: by, behavior: 'smooth' });
			} else {
				window.scrollBy({ top: val, behavior: 'smooth' });
			}
		}

		function followRel(rel) {
			const link = document.querySelector(`link[rel="${rel}"]`);
			if (link && link.href) window.location.href = link.href;
			else showHelp(`No rel="${rel}" link on this page.`);
		}

	function isTypingTarget(el) {
		return el && (
			el.tagName === 'INPUT' ||
			el.tagName === 'TEXTAREA' ||
			el.isContentEditable
		);
	}

	let gPressed = false; // track double-g

	window.addEventListener('keydown', (e) => {
		if (!overlay.hidden) return; // don't hijack while in command mode
		if (isTypingTarget(e.target)) return; // don't hijack typing

		switch (e.key) {
			case 'j':
				e.preventDefault();
				window.scrollBy({ top: 60, behavior: 'smooth' }); // adjust px
				break;
			case 'k':
				e.preventDefault();
				window.scrollBy({ top: -60, behavior: 'smooth' });
				break;
			case 'g':
				if (gPressed) {
					e.preventDefault();
					window.scrollTo({ top: 0, behavior: 'smooth' }); // gg -> top
					gPressed = false;
				} else {
					gPressed = true;
					setTimeout(() => { gPressed = false }, 400); // must press second g quickly
				}
				break;
			case 'G':
				e.preventDefault();
				window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' }); // G -> bottom
				break;
		}
	});

		// Restore theme from storage
		try {
			const saved = localStorage.getItem('theme');
			if (saved) document.documentElement.dataset.theme = saved;
		} catch {}
	})();
	</script>

  </body>
</html>
